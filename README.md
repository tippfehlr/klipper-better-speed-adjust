<div align="center" width="100%">
  <picture>
    <source media="(prefers-color-scheme: dark)" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD6ElEQVR4nO2bS0gVURjHpxc9jaQUUbDXIoqetBMjW/QQErO0QFoFLSsJItCg265aRFCg6CroQbTK8k2PnRA9oIJCI2gTpEZR0Vt/cfBc+LzOvZ65c67dGecPsznz/+Y75z/fnOc3jhMhQoQIEcYDmAbsB7qAQYIHVedOoEa1xfECYCHQQXjQBuR4efMdwvgD0AicDdjVBAyIdtwxigTggDDqBpY4AYWqO9Aj2lNtYtQl3nxgGx8HkCf6sHYTgyFNbnJCAqBZt2nAhDyiyTEDbr5S2EfFlgNzfdgb+Vdt0W0aMXkoJgIARcBX4AtQ6LHuyn6PFvuxV1uv/oUA2BSgTHDL0mjAaeNK+fSfrQLEIgE0vIrn9QVEEUD0CcSMo43J6wPOC/t5U+ITYHSdcQjoYyx+AFeBpSbPCaQAwCzgFqnxCdgSVgEuCr6abp8AdgBVwDUxA1UiFIdKAGAVMKy5r9QszoVTK0S4EjYBzghu0hAHrmvOd2BOmARo1bx3E/D2iWduCpMA3Zr3YgLedvHMkjAJ0KJ5P4FFKXinxDMLwyRAleA2J+EUA58155lBPQMlwAzgueaO6IjIFfdLgdfieXtDJYACsBb4KGx+AS+B94xFo2OAwAmgAKwBnuAONfTVA9OdsAog1gOqt38o7I8CBY4H/FcBgI2iZ0fvum6YrB0hr/6tCQDkAjeThLDq3G6kGubSrpRP/1YEAHKApwkO+/Xc/q8oV9/4AtsCuPgf1iNHv1hDuPq3JUCjuPdIdWjiXqFWP47LGRBA+u+RewfACn0S7OrftwBAAfBbl/e5HWbozu22GOLybQmQ4L/XbaTQ+w29bv5tCHBQlNeksF0neLUWBZD+S1Pwdrr5tyFAvShPum2lo0DN9xXqLQog/c9OwVssePU2BTguytensJ0vOqQ6iwJI/0nPAoGVgldnU4BtovxcCtvDgrfVogDS/zGT4zbp34YAM4G3uvyPmsm52K0Wq7k3agFkUQDp/xuw2YVToju/cf5tDYOVCWOwmn1VALtUVOiTWvQnUJGBYVD6VyPCBaAc2A1cEn3POP82Z4J1CZOeRKh7RzI4E0zLv9W1AKNr9wdilzceEfcn2sZKu1I+/WdqNVguuOVeGuG5Uj79Z9VyOI4oP4AoQSLm8xMI5o5QHFEEEPwkqSKfaXKV2ZomN2IigEhD9ZMoucxnomReJhIlh0KYKtviJVW2M04OSbJ0vnipbSYGNQl7b2mHeJY0/p6XIzdH7+qoPyziGNQrvwbgZECuBh328TePzlEw+3WG0S3ou4QHrSZb9W6RUK1/n1E/TwQNqs7tKuw9/zQVIUKECM4UwT8mlcxfKam85wAAAABJRU5ErkJggg==">
    <source media="(prefers-color-scheme: light)" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD3ElEQVR4nO2bSWgUQRSGv1GDa8SgCSEB14MorngLSvTgElBiolEQT4JHNQgiRCHxph5EUIiYk+CCeDKuSXC5CeICKihRBC9CTEQx4p6MFLyGZzO9TffE6U7/UDBUv+q/6u+aqvdqgRQpUqRIkRMZYBvQBfQD2ZglU+fbQJO0JRCmAreKoBFRpRtAqd/GZ2yN7wPagaMxS2eAD6od1/z2hO2qUDcwg/jC1L1HtWern0Jd6svHufEWytUYdtNPgQExNl0oKTgrbTJ/CU8Mi3GbD9sKUThfzAEmhijvl79N2mTa5omsTwGqgUHgC1BFcGyWCj3Ko2xQfksAkyITYLWyNb+DojVIpULyF6UAbakApD0gm/4FGL1jwHFVftJoESAD7AJ6bcHKd+A8MMvne2IpQAlwxSNq+wSsSqoAJ5W9cbcPAOuABuCC8kCNCDOTJsB8YEhsX4oXZ8cOJcK5pAlwRNm6dfGLYvMNmJAkATrF7p2H3Rb1zuVJEqBb7J572K1V76xJkgAdYvcDmOZid1i9sypJAjQoW7M4kQtm5P8sNk991DNWAowFnontsPSIMvV8JfBKva8xaQIYLAI+qjI/gRfAe5szZFagSaIABguBxw5eoJn6WoAxJFgAKx4wo/19VX4vUEkw/FcBlqmR3RrYlo7gilBQ/sgEKAMuO3RhM7hd8pjm8q5USP5IBCgFntgIX4tv/0flm//4lAIIYOcfkpnjtYohnPgjEaBdPXsoA5qFKlHfen66AAJo/h7b2sFc2Ql24g8tQCXwS/J7HTYzzOB2VU1xZtPCDUEqpfkfOMwUJfIsF39oAXaqfLPf7oTFys6Et24IUinNb5wmJ6x34A8tQIvKd1u2yoi/n5UybghSKc0/3sVuurJriVKA/Sp/iUvZyWpAavbgCVIpze+2FzhP2TVHKcAalX/MpexuZVfrwROkUpp/n8/tttooBRgHvJX83+LJ2bFARXNvJAByQ5BKaf6vwIocNjUy+OXij2QarLfNwcb72gRskF4xqPwDkx/1NKj5zYxwAqgDNgKn1NiTiz8yT7DZ5vTYk3m2p4CeYL78kcYCK4F7apXX6hF3fSxj5V2pkPwFiQbrlK35PdLb40H4iyoctpCeDyBcD4jtgoiFVABGeQ9ojbsA1SGPydUX6zG5YZ8CIIFJmIOSs0MelCwvxEHJgQQele0IclT2tjJOwmHpCvVRzb0BTzTZ1t7CdPFiaPydgFtuZEQpq1C/RH6HgIMxSYek21tfPitnFHxfnSkFrrtEXXFLnT6X6v9BRm5Y3JLLE9mYpT65INGYz6WpFClSpGA04C8pEraioVqQYgAAAABJRU5ErkJggg==">
    <img alt="icon: a dj mixer">
  </picture>
</div>

# Klipper: better speed adjust!
Individually adjust speeds for walls, infill, support and more!

Currently works with Cura, please add support for other slicers!

Supported line types:

- infill (TYPE_FILL)
- skin (TYPE_SKIN) (-> first/last few layers)
- skirt (TYPE_SKIRT) (also brim/raft)
- support (TYPE_SUPPORT)
- wall_inner (TYPE_WALL_INNER)
- wall_outer (TYPE_WALL_OUTER)

If you find more, please add them or open an issue! \
Any unknown line types should only result in a warning `Unknown command`.

## How it works

This script utilizes the `;TYPE:` comment by Cura.
The comments are replaced with `TYPE_` to make them a macro call.

Then, a macro `SET_SPEEDS` is called by the user to set the speed for each line type.
While printing, the `TYPE_` macros set `M220` to the corresponding speed.

**IMPORTANT: once you set one of the speeds, DO NOT USE M220,
neither the speed slider! This macro will overwrite it.**

## Usage

### UI

The macro UI of your klipper/moonraker frontend is probably the most intuitive option. \
**Speeds are in percent!**

> [!TIP]
> hiding the `TYPE_` macros will prevent clutter.

### in terminal

```gcode
; to get current speeds
SET_SPEEDS

; to set speeds, e.g. 100% for everything
SET_SPEEDS INFILL=100 SKIN=100 SKIRT=100 SUPPORT=100 WALL_INNER=100 WALL_OUTER=100

; to disable custom speed control and use M220 / speed slider again
DISABLE_CUSTOM_SPEEDS
```

## Installation

#### Install gcode macros

Include [`betterspeedadjust.cfg`](./betterspeedadjust.cfg) in your printer config.
There are multiple ways, I have the file in `macros/`
and include it with `[include macros/*.cfg]`.

If you don’t already know what to do, download `betterspeedadjust.cfg`
<a download="https://raw.githubusercontent.com/tippfehlr/klipper-better-speed-adjust/main/betterspeedadjust.cfg">here</a>,
upload it to your printer’s config directory and include it by
putting `[include betterspeedadjust.cfg]` into your `printer.cfg`.

#### Configure Cura

In Cura, go to `Extensions` > `Post Processing` > `Modify G-Code`
and add a new script `Search and Replace`:

Search: `;TYPE:` \
Replace: `TYPE_`

Add two more ***after the one above (IMPORTANT)***:

Search: `TYPE_WALL-INNER` \
Replace: `TYPE_WALL_INNER`

and

Search: `TYPE_WALL-OUTER` \
Replace: `TYPE_WALL_OUTER`

Leave regex unchecked for all three.
